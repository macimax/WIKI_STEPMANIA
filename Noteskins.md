**Noteskins** define the appearance of notes. They are constructed in a similar manner to [Themes](https://github.com/stepmania/stepmania/wiki/Theming) (with a mixture of graphics, metrics, and Lua scripts), although they are, by nature, not _as_ complicated. 
On StepMania 5.0 and 5.1, noteskins are specific to a single [game mode](https://github.com/stepmania/stepmania/wiki/Supported-Game-Modes)

Unlike theming (where we explicitly recommended that you _not_ do this), it is okay to copy the Default noteskin to use as a base for your own. A more complex example is midi-note, which closer resembles the look and behavior of _Dance Dance Revolution_ noteskins.

# Files
## Sprites
Noteskins consist of a series of sprites divided into several categories. They include (using the standard ``dance`` mode as an example;

* **Taps**: An individual note. Tap notes are usually either a 2D sprite or a 3D model, but ease of explanation, the examples in this guide will use 2D noteskins. Types of tap notes include, for instance
  * **Notes**: A normal note.
  * **Mines**: Avoid at all cost.
  * **Lifts**: A note where you must hold on the panel and let go as it reaches the receptors, rather than pressing it when it reaches the receptors.
  * **Fakes**: They don't do anything.
* **Holds** and **Rolls**: a tail that must be held or repeatedly tapped for a length of time. They are typically divided into three parts; top and bottom caps, and a body that is tiled for the length of the note. They also have active and inactive states.
  * Some noteskins may have a **Hold Head** and/or **Roll Head**, a specific note sprite used for the head of a hold or roll, as opposed to the standard note sprite. They too have active and inactive states.
* **Receptors**: The targets.
* **Explosions**: Effects overlaid on the note when hit/held/etc. Some noteskins may distinguish between dim and bright explosions, triggering the latter after a specific combo milestone.

These sprites can either be shared by all columns, or specific columns may use different assets to set them apart from the rest; for example, most Dance noteskins only include sprites for the down arrow, because they can just be rotated for the other directions, rather than needing to have individual sprites for each direction. By contrast, Pump noteskins often use distinct sprites for each direction due to their traditional column-based color schemes).

## Scripts
As with the screens of themes, these sprites are generated by Lua scripts which define their constituent [actors](https://github.com/stepmania/stepmania/wiki/Theming#actors), which are typically Sprites that use the images contained within the noteskin's folder. In the default noteskin, Down Tap Note.lua defines a common tap note with animated dots which pulse in visibility to the beat;

```Lua
local t = Def.ActorFrame {
	Def.Sprite {
		Texture="_arrow";
		Frame0000=0;
		Delay0000=1;
	};
	Def.Sprite {
		Texture="_circle";
		Frame0000=0;
		Delay0000=1;
		InitCommand=cmd(y,15;effectclock,"beat";diffuseramp;effectcolor1,color("1,1,1,0");effectcolor2,color("1,1,1,0.35");effectoffset,0);
	};
	Def.Sprite {
		Texture="_circle";
		Frame0000=0;
		Delay0000=1;
		InitCommand=cmd(y,5;effectclock,"beat";diffuseramp;effectcolor1,color("1,1,1,0");effectcolor2,color("1,1,1,0.35");effectoffset,0.25);
	};
	Def.Sprite {
		Texture="_circle";
		Frame0000=0;
		Delay0000=1;
		InitCommand=cmd(y,-5;effectclock,"beat";diffuseramp;effectcolor1,color("1,1,1,0");effectcolor2,color("1,1,1,0.35");effectoffset,0.5);
	};
	Def.Sprite {
		Texture="_circle";
		Frame0000=0;
		Delay0000=1;
		InitCommand=cmd(y,-15;effectclock,"beat";diffuseramp;effectcolor1,color("1,1,1,0");effectcolor2,color("1,1,1,0.35");effectoffset,0.75);
	};
};
return t;
```

NoteSkin.lua contains definitions for the sprites in use. The ``RedirTable`` tells StepMania which Lua files to load for the note sprites in each column. Usually in a Dance noteskin, they are all set to Down, and then the ``ret.Rotate`` table is used to specify how many degrees the Down arrow is rotated to transform it into the note for a different column (i.e. rotating down 180 degrees to make Up, 90 degrees for Left, etc).

If you want to use a distinct graphic for a column's notes - for example, Left, you must;
 * Create a new Lua file for that actor (i.e. ``Left Tap Note.lua``) and a relevant graphic
 * Change the RedirTable to point the Left direction to Left.
 * Change the Rotation table so that it does not rotate its sprite at all

## Metrics
Much like themes, there is also a metrics.ini file, which is used to define certain settings and parameters.

# Notes
Noteskins can either be _flat_ (all notes are the same color), or _[quantized](https://en.wikipedia.org/wiki/Quantization_(music))_ (all arrows are coloured by their note values, i.e. 4th, 8th, 16th, etc.). 

For noteskins with colors based on quantification, all the different colors for notes are contained within the same image file, which are arranged in frames of equal size (in the default noteskin, each frame is 128x128 in size) in a single column. The ``1x8`` hint contained in the file name of the arrow sheet (``_arrow 1x8.png``), tells StepMania to treat this image as eight rows of single-frame sprites.

## Animation
### Sprite-based
The easiest way to add animation to a tap note is to extend its respective graphic out horizontally with additional frames. StepMania will play the series of sprites on a loop based on the song's current BPM. Usually, such an animation would have 4 or 8 frames; don't forget to change the hint in the file name to match the new frame count, which in this case would be  ``_arrow 4x8.png`` or ``_arrow 8x8.png`` for example.

Similar techniques can be used to add animation to other tap sprites too, such as mines and lifts.

#### Vivid
Normally, note animations in StepMania only use the frames within the row corresponding to the respective note quantization. However, StepMania can also animate the noteskin in such a way that the animation continues to cycle through the other colors in the sheet rather than only being one color; this is referred to as a **vivid** animation, as it resembles the behaviour of the "Vivid" arrows from _Dance Dance Revolution_ (the midi-vivid noteskin bundled with StepMania also uses this behaviour).

This mode is activated by changing the metrics like so;
```ini
[NoteDisplay]
TapNoteAnimationIsVivid=1
TapAdditionAnimationIsVivid=1
```

### Actor commands
In some cases, commands applied to the to a note's actor can also be used to add motion effects. For instance, this ``Down Tap Mine.lua`` file makes the mine spin;
```Lua
local t = Def.ActorFrame {
	Def.Sprite {
		Texture=NOTESKIN:GetPath( '_down', 'tap mine' );
		Frame0000=0;
		Delay0000=1;
		InitCommand=cmd(spin;effectclock,'beat';effectmagnitude,0,0,-33);
	};
};
return t;
```

## Explosions
Note explosions are defined under the ``[GhostArrowDim]`` and ``[GhostArrowBright]`` sections of metrics.ini, and are merely commands acting upon a sprite of a "glowing" note graphic. The animation and its color can be changed between the different note judgments (they go downward from W1 to W5, with W1 as the top judgement usually referred to as "Flawless", "Fantastic", or "Marvelous", and W5 being the worst before a miss) with standard tweens and diffuses.